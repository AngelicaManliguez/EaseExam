<!DOCTYPE html>
<html>
<head>
    <title>EaseExam Application</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container mt-5">
    <h1 style="color:white">EaseExam</h1>
    <div class="form-group mt-3">
        <textarea class="form-control" rows="5" placeholder="Enter the text with all the information needed for the quiz or exam" id="text-input"></textarea>
        <div class="custom-file">
            <input type="file" class="custom-file-input" id="file-input" multiple>
            <label class="custom-file-label" for="file-input">Choose file...</label>
        </div>
    </div>
    <button type="button" class="btn btn-primary" id="generate-quiz-btn">Generate Questions</button>
    <div id="output"></div>
</div>
<script>
  document.getElementById('file-input').addEventListener('change', function (e) {
      var fileNames = [];
      for (var i = 0; i < this.files.length; i++) {
          fileNames.push(this.files[i].name);
      }
      document.querySelector('.custom-file-label').textContent = fileNames.join(', ');
  });
  function generateQuiz() {
      const textInput = document.querySelector("#text-input");
      const fileInput = document.querySelector("#file-input");
      const outputDiv = document.querySelector("#output");

      const formData = new FormData();
      formData.append("text", textInput.value);
      for (let i = 0; i < fileInput.files.length; i++) {
          formData.append("file" + i, fileInput.files[i]);
      }

      fetch("/api/generate_quiz", {
          method: "POST",
          body: formData
      })
      .then(response => response.json())
      .then(data => {
          outputDiv.innerHTML = ""; // Clear previous output

          // Show user input image and text
          const userInputDiv = document.createElement("div");
          userInputDiv.classList.add("message", "user-message", "image");
          userInputDiv.innerHTML = `
              <img src="{{ url_for('static', filename='images/user.png') }}" alt="User Input Image" style="width: 100px; height: 100px;">
              <p>User Input:</p>
              <p>${textInput.value}</p>
          `;
          outputDiv.appendChild(userInputDiv);

          // Show uploaded files
          if (data.saved_files) {
              const filesMessageDiv = document.createElement("div");
              filesMessageDiv.classList.add("message", "user-message");
              filesMessageDiv.innerHTML = "<p>Uploaded Files:</p>";
              data.saved_files.forEach(file => {
                  filesMessageDiv.innerHTML += "<p>" + file + "</p>";
              });
              outputDiv.appendChild(filesMessageDiv);
          }

          // Show GPT image and generated questions
          if (data.questions) {
              const gptMessageDiv = document.createElement("div");
              gptMessageDiv.classList.add("message", "bot-message", "image");
              gptMessageDiv.innerHTML = `
                  <img src="{{ url_for('static', filename='images/gpt.jpg') }}" alt="GPT Image" style="width: 100px; height: 100px;">
                  <p>Generated Questions:</p>
              `;
              data.questions.forEach(question => {
                  gptMessageDiv.innerHTML += "<p>" + question + "</p>";
              });
              outputDiv.appendChild(gptMessageDiv);
          } else if (data.error) {
              const errorDiv = document.createElement("div");
              errorDiv.classList.add("message", "error-message");
              errorDiv.innerHTML = "<p>Error: " + data.error + "</p>";
              outputDiv.appendChild(errorDiv);
          }
      })
      .catch(error => {
          console.error(error);
          const errorDiv = document.createElement("div");
          errorDiv.classList.add("message", "error-message");
          errorDiv.innerHTML = "<p>Error: Failed to generate questions.</p>";
          outputDiv.appendChild(errorDiv);
      });
  }

  const generateQuizBtn = document.querySelector("#generate-quiz-btn");
  generateQuizBtn.addEventListener("click", generateQuiz);
</script>

</body>
</html>